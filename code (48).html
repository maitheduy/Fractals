<!DOCTYPE html>
<html>
<head>
    <title>Attractor hệ 2 hàm co</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        canvas {
            border: 1px solid #ddd;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin: 20px;
        }
        .controls {
            margin: 15px 0;
        }
        .formula {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Attractor hệ 2 hàm co</h1>
    
    <div class="formula">
        <p>f₁(x,y) = [1/2, 1/6; 1/2, -1/2] * [x; y] + [0; 0]</p>
        <p>f₂(x,y) = [-1/2, -1/6; 1/2, -1/2] * [x; y] + [2; 0]</p>
    </div>
    
    <div class="controls">
        <label for="points">Số điểm:</label>
        <input type="number" id="points" min="1000" max="100000" step="1000" value="30000">
        <button onclick="drawFractal()">Vẽ Lại</button>
    </div>
    
    <canvas id="fractalCanvas" width="700" height="700"></canvas>

    <script>
        const canvas = document.getElementById('fractalCanvas');
        const ctx = canvas.getContext('2d');
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const scale = 150; // Tỉ lệ phóng đại

        // Màu sắc cho từng hàm
        const colors = ['#00cc66', '#ff0066']; // Xanh lá, Đỏ tươi

        // 2 hàm co
        const transforms = [
            // f1: xanh lá
            (x, y) => ({
                x: 0.5 * x + (1/6) * y,
                y: 0.5 * x - 0.5 * y,
                color: 0
            }),
            // f2: đỏ tươi
            (x, y) => ({
                x: -0.5 * x - (1/6) * y + 2,
                y: 0.5 * x - 0.5 * y,
                color: 1
            })
        ];

        // Tính xác suất dựa trên định thức
        function calculateProbabilities() {
            const detA = Math.abs(0.5*(-0.5) - (1/6)*0.5);
            const detB = Math.abs(-0.5*(-0.5) - (-1/6)*0.5);
            const Su = detA + detB;
            return {
                p1: detA/Su,
                p2: detB/Su
            };
        }

        // Tạo điểm ngẫu nhiên
        function generatePoints(count) {
            const { p1, p2 } = calculateProbabilities();
            const points = [];
            let x = 0, y = 0;
            
            for (let i = 0; i < count; i++) {
                const r = Math.random();
                let transform;
                
                if (r < p1) {
                    transform = transforms[0];
                } else {
                    transform = transforms[1];
                }
                
                const newPoint = transform(x, y);
                x = newPoint.x;
                y = newPoint.y;
                points.push(newPoint);
            }
            
            return points;
        }

        // Vẽ hệ trục tọa độ với lưới
        function drawAxes() {
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 0.5;
            
            // Vẽ lưới ngang
            for (let y = -2; y <= 2; y += 0.5) {
                const py = centerY - y * scale;
                ctx.beginPath();
                ctx.moveTo(50, py);
                ctx.lineTo(canvas.width - 50, py);
                ctx.stroke();
                
                // Hiển thị giá trị trục Y
                if (y !== 0) {
                    ctx.fillStyle = '#000';
                    ctx.textAlign = 'right';
                    ctx.fillText(y.toFixed(1), 40, py + 4);
                }
            }
            
            // Vẽ lưới dọc
            for (let x = -1; x <= 3; x += 0.5) {
                const px = centerX + x * scale;
                ctx.beginPath();
                ctx.moveTo(px, 50);
                ctx.lineTo(px, canvas.height - 50);
                ctx.stroke();
                
                // Hiển thị giá trị trục X
                if (x !== 0) {
                    ctx.fillStyle = '#000';
                    ctx.textAlign = 'center';
                    ctx.fillText(x.toFixed(1), px, canvas.height - 35);
                }
            }
            
            // Vẽ trục chính
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            // Trục hoành
            ctx.beginPath();
            ctx.moveTo(50, centerY);
            ctx.lineTo(canvas.width - 50, centerY);
            ctx.stroke();
            // Trục tung
            ctx.beginPath();
            ctx.moveTo(centerX, 50);
            ctx.lineTo(centerX, canvas.height - 50);
            ctx.stroke();
            
            // Ghi nhãn trục
            ctx.fillStyle = '#000';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('x', canvas.width - 30, centerY + 20);
            ctx.textAlign = 'right';
            ctx.fillText('y', centerX - 10, 40);
        }

        function drawFractal() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const pointCount = parseInt(document.getElementById('points').value);
            const points = generatePoints(pointCount);
            
            // Vẽ hệ trục trước
            drawAxes();
            
            // Vẽ các điểm
            points.forEach(point => {
                const px = centerX + point.x * scale;
                const py = centerY - point.y * scale;
                ctx.fillStyle = colors[point.color];
                ctx.fillRect(px, py, 2, 2);
            });
        }

        // Vẽ lần đầu
        drawFractal();
    </script>
</body>
</html>
